DO
$$
BEGIN

  IF NOT EXISTS (
    SELECT 1 
    FROM pg_database 
    WHERE datname = 'cmp1611_paulo_artur'
  ) THEN

    CREATE DATABASE cmp1611_paulo_artur
    WITH 
      ENCODING = 'UTF8'
      LC_COLLATE = 'en_US.UTF-8'
      LC_CTYPE = 'en_US.UTF-8'
      TEMPLATE = template0;
  END IF;
END
$$;


/*
CREATE TABLE IF NOT EXISTS PROPRIETARIOS (
    CPF_PROP BIGINT PRIMARY KEY NOT NULL,
    CNH_PROP VARCHAR(15) NOT NULL,
    BANCO_PROP INTEGER,
    AGENCIA_PROP INTEGER,
    CONTA_PROP INTEGER
);

INSERT INTO PROPRIETARIOS (CPF_PROP, CNH_PROP, BANCO_PROP, AGENCIA_PROP, CONTA_PROP)
VALUES
    (12345678901, 'CNH1234567890', 123, 456, 789),
    (98765432109, 'CNH0987654321', 234, 567, 890);

CREATE TABLE IF NOT EXISTS PESSOAS (
    CPF_PESSOA BIGINT  PRIMARY KEY NOT NULL,
    NOME VARCHAR(50) NOT NULL,
    ENDERECO VARCHAR(50),
    TELEFONE BIGINT,
    SEXO VARCHAR(1) CHECK(SEXO IN ('M', 'F')),
    E_MAIL VARCHAR(30)
    );

INSERT INTO PESSOAS (CPF_PESSOA, NOME, ENDERECO, TELEFONE, SEXO, E_MAIL) VALUES
    (12345678901, 'João Silva', 'Rua A, 123', 62994670109, 'M', 'joao.silva@example.com'),
    (98765432109, 'Maria Santos', 'Av. B, 456', 11912345678, 'F', 'maria.santos@example.com');

CREATE TABLE IF NOT EXISTS PASSAGEIROS (
    CPF_PASSAG BIGINT PRIMARY KEY NOT NULL,
    CARTAO_CRED VARCHAR(20),
    BANDEIRA_CARTAO VARCHAR(20),
    CIDADE_ORIG VARCHAR(30)
    );

INSERT INTO PASSAGEIROS (CPF_PASSAG, CARTAO_CRED, BANDEIRA_CARTAO, CIDADE_ORIG)
VALUES
    (12345678901, '1234567812345678', 'VISA', 'São Paulo'),
    (98765432109, '9876543298765432', 'MasterCard', 'Rio de Janeiro');

CREATE TABLE IF NOT EXISTS MOTORISTAS (
    CPF_MOTORISTA BIGINT PRIMARY KEY NOT NULL,
    CNH VARCHAR(15) NOT NULL,
    BANCO_MOT INTEGER,
    AGENCIA_MOT INTEGER,
    CONTA_MOT INTEGER
    );

INSERT INTO MOTORISTAS (CPF_MOTORISTA, CNH, BANCO_MOT, AGENCIA_MOT, CONTA_MOT)
VALUES
    (12345678901, 'CNH123456789', 123, 456, 789),
    (98765432109, 'CNH987654321', 234, 567, 890);

CREATE TABLE IF NOT EXISTS VEICULOS (
    PLACA CHAR(7) NOT NULL CHECK (PLACA ~ '^[A-Z]{3}\d{1}[A-Z]{1}\d{2}$'),
    MARCA VARCHAR(30) NOT NULL,
    MODELO VARCHAR(30) NOT NULL,
    ANO_FABRIC INTEGER NOT NULL,
    CAPACIDADE_PASS INTEGER NOT NULL,
    COR VARCHAR(30) NOT NULL,
    TIPO_COMBUST CHAR(1) NOT NULL CHECK (TIPO_COMBUST IN ('G', 'A', 'D', 'F')),
    POTENCIA_MOTOR INTEGER,
    CPF_PROP BIGINT  NOT NULL,
    PRIMARY KEY (PLACA),
    FOREIGN KEY (CPF_PROP) REFERENCES PROPRIETARIOS(CPF_PROP)
    );

INSERT INTO VEICULOS (PLACA, MARCA, MODELO, ANO_FABRIC, CAPACIDADE_PASS, COR, TIPO_COMBUST, POTENCIA_MOTOR, CPF_PROP)
VALUES
    ('ABC1D23', 'Toyota', 'Corolla', 2020, 5, 'Branco', 'G', 132, 12345678901),
    ('XYZ9L87', 'Honda', 'Civic', 2019, 5, 'Preto', 'G', 158, 98765432109);

CREATE TABLE IF NOT EXISTS TIPOS_PAGTOS (
    COD_PAGTO INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    DESC_PAGTO VARCHAR(20)
    );

INSERT INTO TIPOS_PAGTOS (DESC_PAGTO)
VALUES
    ('Pagamento à vista'),
    ('Pagamento parcelado');

CREATE TABLE IF NOT EXISTS MOTORISTAS_VEICULOS (
    CPF_MOTORISTA BIGINT NOT NULL,
    PLACA CHAR(7) NOT NULL REFERENCES VEICULOS(PLACA),
    PRIMARY KEY (CPF_MOTORISTA, PLACA),
    FOREIGN KEY (CPF_MOTORISTA) REFERENCES MOTORISTAS(CPF_MOTORISTA),
    FOREIGN KEY (PLACA) REFERENCES VEICULOS(PLACA)
    );

INSERT INTO MOTORISTAS_VEICULOS (CPF_MOTORISTA, PLACA)
VALUES
    (12345678901, 'ABC1D23'),
    (98765432109, 'XYZ9L87');
    
    CREATE TABLE IF NOT EXISTS VIAGENS (
    CPF_PASSAG BIGINT NOT NULL,
    CPF_MOTORISTA BIGINT NOT NULL,
    PLACA CHAR(7) NOT NULL,
    LOCAL_ORIG_VIAG VARCHAR(30),
    LOCAL_DEST_VIAG VARCHAR(30),
    DT_HORA_INICIO DATE NOT NULL,
    DT_HORA_FIM DATE,
    QTDE_PASS INT,
    FORMA_PAGTO VARCHAR(10) NOT NULL CHECK (FORMA_PAGTO IN ('DINHEIRO', 'CARTAO', 'POSTERIORI')),
    VALOR_PAGTO DECIMAL(10,2),
    CANCELAM_MOT VARCHAR(1) NOT NULL CHECK (CANCELAM_MOT IN ('S', 'N')),
    CANCELAM_PASS VARCHAR(1) NOT NULL CHECK (CANCELAM_PASS IN ('S', 'N')),
    COD_PAGTO INTEGER NOT NULL,
    PRIMARY KEY (CPF_PASSAG, CPF_MOTORISTA, PLACA, DT_HORA_INICIO),
    FOREIGN KEY (CPF_PASSAG) REFERENCES PASSAGEIROS(CPF_PASSAG),
    FOREIGN KEY (CPF_MOTORISTA, PLACA) REFERENCES MOTORISTAS_VEICULOS(CPF_MOTORISTA, PLACA),
    FOREIGN KEY (COD_PAGTO) REFERENCES TIPOS_PAGTOS(COD_PAGTO)
);

INSERT INTO VIAGENS (CPF_PASSAG, CPF_MOTORISTA, PLACA, LOCAL_ORIG_VIAG, LOCAL_DEST_VIAG, DT_HORA_INICIO, QTDE_PASS, FORMA_PAGTO, VALOR_PAGTO, CANCELAM_MOT, CANCELAM_PASS, COD_PAGTO)
VALUES
    (12345678901, 12345678901, 'ABC1D23', 'São Paulo', 'Rio de Janeiro', '2024-05-10 09:00:00', 1, 'DINHEIRO', 150.00, 'N', 'N', 1),
    (98765432109, 98765432109, 'XYZ9L87', 'Rio de Janeiro', 'São Paulo', '2024-05-10 10:00:00', 1, 'CARTAO', 200.00, 'S', 'N', 2);

*/